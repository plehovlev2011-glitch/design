<!DOCTYPE html>
<html>
<head>
<title>Area Selector</title>
<style>
body {
  margin: 20px;
  font-family: Arial, sans-serif;
}

.toolbar {
  margin-bottom: 20px;
  padding: 15px;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 5px;
}

.controls {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
  align-items: center;
}

input, select, button {
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
}

input {
  width: 200px;
}

button {
  background: #007bff;
  color: white;
  border: none;
  cursor: pointer;
  min-width: 100px;
}

button:hover {
  background: #0056b3;
}

#clear {
  background: #dc3545;
}

#clear:hover {
  background: #c82333;
}

#copy {
  background: #28a745;
}

#copy:hover {
  background: #218838;
}

#active {
  background: #ffc107;
  color: #000;
}

.image-container {
  position: relative;
  display: inline-block;
  border: 1px solid #ddd;
  background: #fff;
}

#mainImage {
  display: block;
  max-width: 100%;
  height: auto;
}

.selection-area {
  position: absolute;
  border: 2px solid #007bff;
  background: rgba(0, 123, 255, 0.2);
  pointer-events: none;
  z-index: 10;
}

.selection-label {
  position: absolute;
  top: -25px;
  left: 0;
  background: #007bff;
  color: white;
  padding: 2px 8px;
  font-size: 12px;
  border-radius: 3px;
  white-space: nowrap;
}

#coordOutput {
  position: fixed;
  bottom: 10px;
  right: 10px;
  background: #f8f9fa;
  border: 1px solid #ddd;
  padding: 10px;
  font-family: monospace;
  font-size: 12px;
  max-width: 400px;
  max-height: 200px;
  overflow: auto;
  display: none;
}

.info {
  color: #666;
  font-size: 12px;
  margin-top: 10px;
}
</style>
</head>
<body>

<div class="toolbar">
  <h3>Выделение областей на изображении</h3>
  
  <div class="controls">
    <input type="text" id="buttonName" placeholder="Название кнопки" value="about">
    <input type="text" id="buttonLink" placeholder="Ссылка" value="about.html">
    <button id="startSelect">Начать выделение</button>
    <button id="clear">Очистить</button>
    <button id="copy">Копировать код</button>
  </div>
  
  <div class="info">
    Инструкция: 1) Введите название 2) Нажмите "Начать выделение" 3) Кликните и протяните на изображении
  </div>
</div>

<div class="image-container">
  <img id="mainImage" src="hello.png" alt="Ваше изображение">
</div>

<textarea id="coordOutput"></textarea>

<script>
let isSelecting = false;
let startX, startY;
let currentSelection = null;
let selections = [];

const image = document.getElementById('mainImage');
const buttonName = document.getElementById('buttonName');
const buttonLink = document.getElementById('buttonLink');
const startSelectBtn = document.getElementById('startSelect');
const clearBtn = document.getElementById('clear');
const copyBtn = document.getElementById('copy');
const coordOutput = document.getElementById('coordOutput');

// Начало выделения
startSelectBtn.addEventListener('click', function() {
  isSelecting = true;
  image.style.cursor = 'crosshair';
  this.textContent = 'Выделяйте...';
  this.style.background = '#ffc107';
});

// События мыши
image.addEventListener('mousedown', function(e) {
  if (!isSelecting) return;
  
  const rect = this.getBoundingClientRect();
  startX = e.clientX - rect.left;
  startY = e.clientY - rect.top;
  
  // Создаем область выделения
  currentSelection = document.createElement('div');
  currentSelection.className = 'selection-area';
  currentSelection.style.left = startX + 'px';
  currentSelection.style.top = startY + 'px';
  currentSelection.style.width = '0px';
  currentSelection.style.height = '0px';
  
  // Добавляем метку
  const label = document.createElement('div');
  label.className = 'selection-label';
  label.textContent = buttonName.value;
  currentSelection.appendChild(label);
  
  this.parentElement.appendChild(currentSelection);
});

image.addEventListener('mousemove', function(e) {
  if (!isSelecting || !currentSelection) return;
  
  const rect = this.getBoundingClientRect();
  const currentX = e.clientX - rect.left;
  const currentY = e.clientY - rect.top;
  
  const width = currentX - startX;
  const height = currentY - startY;
  
  currentSelection.style.width = Math.abs(width) + 'px';
  currentSelection.style.height = Math.abs(height) + 'px';
  
  if (width < 0) {
    currentSelection.style.left = currentX + 'px';
  }
  if (height < 0) {
    currentSelection.style.top = currentY + 'px';
  }
});

image.addEventListener('mouseup', function(e) {
  if (!isSelecting || !currentSelection) return;
  
  const rect = this.getBoundingClientRect();
  const endX = e.clientX - rect.left;
  const endY = e.clientY - rect.top;
  
  // Вычисляем координаты
  const x1 = Math.min(startX, endX);
  const y1 = Math.min(startY, endY);
  const x2 = Math.max(startX, endX);
  const y2 = Math.max(startY, endY);
  
  // Сохраняем область
  selections.push({
    name: buttonName.value,
    link: buttonLink.value,
    x1: Math.round(x1),
    y1: Math.round(y1),
    x2: Math.round(x2),
    y2: Math.round(y2),
    width: Math.round(x2 - x1),
    height: Math.round(y2 - y1)
  });
  
  // Сбрасываем состояние
  isSelecting = false;
  currentSelection = null;
  image.style.cursor = 'default';
  startSelectBtn.textContent = 'Начать выделение';
  startSelectBtn.style.background = '#007bff';
  
  // Показываем координаты
  console.log(`Сохранено: ${buttonName.value} - ${x1},${y1} - ${x2},${y2}`);
  alert(`Область "${buttonName.value}" сохранена!`);
});

// Очистка
clearBtn.addEventListener('click', function() {
  if (confirm('Удалить все области?')) {
    selections = [];
    document.querySelectorAll('.selection-area').forEach(el => el.remove());
  }
});

// Копирование кода
copyBtn.addEventListener('click', function() {
  if (selections.length === 0) {
    alert('Нет выделенных областей');
    return;
  }
  
  const code = generateCode();
  coordOutput.value = code;
  coordOutput.style.display = 'block';
  coordOutput.select();
  document.execCommand('copy');
  coordOutput.style.display = 'none';
  
  alert('Код скопирован!');
});

// Генерация кода
function generateCode() {
  let htmlCode = '<!-- Кликабельные области -->\n\n';
  
  selections.forEach(area => {
    const xPercent = ((area.x1 / image.naturalWidth) * 100).toFixed(3);
    const yPercent = ((area.y1 / image.naturalHeight) * 100).toFixed(3);
    const widthPercent = ((area.width / image.naturalWidth) * 100).toFixed(3);
    const heightPercent = ((area.height / image.naturalHeight) * 100).toFixed(3);
    
    htmlCode += `<div class="click-area" 
     style="position: absolute;
            left: ${xPercent}%;
            top: ${yPercent}%;
            width: ${widthPercent}%;
            height: ${heightPercent}%;
            cursor: pointer;"
     onclick="window.open('${area.link}', '_self')"
     title="${area.name}">
</div>\n\n`;
  });
  
  return htmlCode;
}

// Проверка загрузки изображения
image.onload = function() {
  console.log('Изображение загружено:', this.naturalWidth, 'x', this.naturalHeight);
};

image.onerror = function() {
  alert('Ошибка загрузки hello.png. Убедитесь, что файл в той же папке.');
};
</script>
</body>
</html>
